var rpc  = require('../')
var es   = require('event-stream')
var test = require('tape')

var obj = {
  error: function (cb) {
    console.log(arguments)
    cb(new Error('error message'))
  }
}

test('error', function (t) {

  //second arg=true means stream of raw js objects,
  //do not stringify/parse.
  var a = rpc(obj, true)
  b = rpc(null, true)
  console.log(obj)
  //a and b are streams. connect them with pipe.
  b.pipe(a).pipe(b)

  b.rpc('error', [], function (err) {
    t.ok(err)
    t.equal(err.message, 'error message')
    console.log(err.stack)
    t.end()
  })
})

